ercitazione1 con semafori

semaphore array[0..99] clients
integer last <- 1
semaphore full <- 0
semaphore baker,mutex <- 1

Fornaio
integer serving <- 0
loop forever
	P(mutex)
	if serving == last
		V(mutex)
		<leggi il giornale>
		
	else
		V(mutex)
		serving <- (serving + 1) % 100
		V(clients[serving])
		P(baker)
		<servi il cliente con indice serving>
		#a che serve il "V(client[next])"?

Cliente
P(mutex)
last <- (last+1) % 100
integer me <- last #qualcuno potrebbe modificare il valore di last prima che il cliente si metta in attesa
V(mutex)
P(client[me])
<ordina spesa>
V(baker)
<esci dal negozio>
 
# se la coda supera le 100 persone io creerei una linked list, i clienti si bloccano su un semaforo e ne creano uno nuovo su cui il prossimo in coda potr√† bloccarsi, quando il cliente prende il numero "sblocca" il semaforo del cliente dopo di lui (senza numero).
#altrimenti blocchiamo tutti i clienti sullo stesso semaforo e li sblocchiamo quando c'e un numero libero, il primo che entra entra.

